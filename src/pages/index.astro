---
import Layout from "../layouts/Layout.astro";
import Hero from "../components/Hero.astro";
import ComparisonSection from "../components/ComparisonSection.astro";
import ProcessTimeline from "../components/ProcessTimeline.astro";
import ImageComparison from "../components/ImageComparison.astro";

// Data & Node Imports
import { getModelData } from "../data/models";
import fs from "node:fs";
import path from "node:path";

// Logic to get featured models
const imagesDir = path.join(process.cwd(), "public/images/imagenes_casas");

// Helper to get image
const getModelImage = (id: string) => {
  let image = "/images/img_fondo1.jpg"; // Fallback
  const modelPath = path.join(imagesDir, id);

  if (fs.existsSync(modelPath)) {
    const files = fs.readdirSync(modelPath).filter((f) => !f.startsWith("."));
    const mainImg =
      files.find(
        (f) =>
          f.toLowerCase().startsWith("1-") || f.toLowerCase().includes("main"),
      ) || files[0];

    if (mainImg) {
      image = `/images/imagenes_casas/${id}/${mainImg}`;
    }
  }
  return image;
};

// Logic to get featured models
const featuredModelIds = ["Amazon", "Sinai", "Milan", "Sofia"];

const featuredModels = featuredModelIds.map((id) => {
  const data = getModelData(id);
  // Clean price string for display
  const displayPrice = data.specs.price.replace(/Desde\s+/i, "");

  return {
    ...data,
    price: displayPrice,
    image: getModelImage(id),
  };
});

// Logic to get category images
const categoryImages = {
  modular: getModelImage("Amazon"),
  familiar: getModelImage("Milan"),
  alpina: getModelImage("Ararat"),
  studio: getModelImage("Mini Giza"),
};
---

<Layout title="Casas prefabricadas y modulares | Colven Construcciones">
  <Hero />

  <main>
    <!-- FILOSOF√çA TAYGA -->
    <section class="philosophy">
      <div class="container philosophy-grid">
        <div class="philosophy-text">
          <span class="eyebrow">Filosof√≠a Tayga</span>

          <h2>Arquitectura que respira con la naturaleza</h2>

          <p>
            Nuestras casas no solo se construyen en el entorno, sino que forman
            parte de √©l. Utilizamos madera sostenible certificada y t√©cnicas de
            construcci√≥n pasiva para crear hogares que son refugios de
            bienestar, eficiencia y belleza atemporal.
          </p>

          <a href="/nosotros" class="text-link">
            Descubre nuestra historia ‚Üí
          </a>
        </div>

        <div class="philosophy-media">
          <img src="/images/img_fondo1.jpg" alt="Interior de casa de madera" />

          <div class="media-caption">
            <span class="model">MODELO ALPINA</span>
            <strong>Interior calidez escandinava</strong>
          </div>
        </div>
      </div>
    </section>

    <!-- MODELOS EXCLUSIVOS -->
    <section class="models">
      <div class="container">
        <div class="models-header">
          <span class="eyebrow">Nuestra colecci√≥n</span>
          <h2>Modelos exclusivos</h2>
          <p>Dise√±os pensados para habitar en armon√≠a</p>
        </div>

        <div class="models-grid">
          <a href="/modelos/Amazon" class="model-card">
            <img src={categoryImages.modular} alt="Serie modular" />
            <h3>Serie Modular</h3>
            <span>80m¬≤ ‚Äì 150m¬≤</span>
          </a>

          <a href="/modelos/Milan" class="model-card">
            <img src={categoryImages.familiar} alt="Residencia familiar" />
            <h3>Residencia Familiar</h3>
            <span>140m¬≤ ‚Äì 280m¬≤</span>
          </a>

          <a href="/modelos/Ararat" class="model-card">
            <img src={categoryImages.alpina} alt="Caba√±a alpina" />
            <h3>Caba√±a Alpina</h3>
            <span>45m¬≤ ‚Äì 90m¬≤</span>
          </a>

          <a href="/modelos/Mini Giza" class="model-card">
            <img src={categoryImages.studio} alt="Garden Studio" />
            <h3>Garden Studio</h3>
            <span>25m¬≤ ‚Äì 60m¬≤</span>
          </a>
        </div>
      </div>
    </section>

    <section class="why-us">
      <div class="container">
        <header class="why-us-header">
          <h2>¬øPor qu√© elegirnos?</h2>
          <span class="underline"></span>
        </header>

        <div class="why-us-grid">
          <article class="why-card">
            <div class="why-icon">üè°</div>
            <h3>Rapidez</h3>
            <p>
              Valoramos el tiempo de nuestros clientes y por eso entregamos los
              proyectos a tiempo, con procesos √°giles y bien definidos.
            </p>
          </article>

          <article class="why-card">
            <div class="why-icon">üèÖ</div>
            <h3>Calidad superior</h3>
            <p>
              Cuidamos cada detalle desde la selecci√≥n de la madera hasta el
              √∫ltimo acabado de la vivienda.
            </p>
          </article>

          <article class="why-card">
            <div class="why-icon">üåø</div>
            <h3>Respetuosos con el medio ambiente</h3>
            <p>
              Utilizamos madera sostenible y sistemas constructivos eficientes y
              responsables con el entorno.
            </p>
          </article>

          <article class="why-card">
            <div class="why-icon">üîë</div>
            <h3>Llave en mano</h3>
            <p>
              Nos encargamos de todo el proceso, desde la idea inicial hasta la
              entrega final de la vivienda.
            </p>
          </article>

          <article class="why-card">
            <div class="why-icon">‚úèÔ∏è</div>
            <h3>Personalizaci√≥n total</h3>
            <p>
              Adaptamos cada proyecto a tus necesidades y realizamos
              modificaciones sin complicaciones.
            </p>
          </article>
        </div>
      </div>
    </section>

    <section class="top-products">
      <div class="container">
        <header class="top-products-header animate-on-scroll">
          <h2>Nuestros productos top</h2>
          <span class="underline"></span>
        </header>

        {/* TOP PRODUCTS SECTION DYNAMIC */}
        <div class="top-products-grid animate-on-scroll">
          {
            featuredModels.map((model) => (
              <article class="product-card">
                <div class="product-media">
                  <span class="badge-top">TOP</span>

                  <button class="fav-btn" aria-label="Favorito">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
                    </svg>
                  </button>

                  <a href={`/modelos/${model.id}`} class="img-link">
                    <img
                      src={model.image}
                      alt={`Modelo ${model.name}`}
                      loading="lazy"
                    />
                  </a>
                </div>

                <h3>{model.name}</h3>

                <ul class="product-features">
                  <li>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path d="M3 21h18" />
                      <path d="M5 21V7l8-4 8 4v14" />
                      <path d="M17 21v-8H7v8" />
                    </svg>{" "}
                    {model.specs.rooms} estancias
                  </li>
                  <li>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <rect x="4" y="2" width="16" height="20" rx="2" ry="2" />
                    </svg>{" "}
                    {model.specs.surface}
                  </li>
                </ul>

                <p class="price">
                  Precio desde <strong>{model.price}</strong>
                </p>

                <a href={`/modelos/${model.id}`} class="btn-outline">
                  M√°s informaci√≥n
                </a>
              </article>
            ))
          }
        </div>
      </div>
    </section>

    <!-- NUEVO: COMPARATIVA -->
    <ComparisonSection />

    <!-- NUEVO: TIMELINE PROCESO -->
    <ProcessTimeline />

    <!-- NUEVO: SLIDER IMAGEN -->
    <ImageComparison />

    <section class="budget-section">
      <div class="container">
        <header class="budget-header">
          <span class="eyebrow">Contacto</span>
          <h2>Solicita tu presupuesto</h2>
          <span class="underline"></span>
        </header>

        <div class="budget-grid">
          <div class="budget-info">
            <h3>Tu refugio comienza con un plan</h3>
            <p>
              D√©janos tus datos y cu√©ntanos qu√© tienes en mente. Nuestro equipo
              te contactar√° para definir los detalles de tu futura casa de
              madera.
            </p>

            <ul class="budget-steps">
              <li><strong>01.</strong> Asesoramiento personalizado</li>
              <li><strong>02.</strong> Estudio t√©cnico de viabilidad</li>
              <li><strong>03.</strong> Presupuesto detallado sin compromiso</li>
            </ul>

            <div class="simulator-cta">
              <a href="/presupuesto" class="btn-outline btn-simulator">
                Simular presupuesto
              </a>
              <p class="cta-note">Obt√©n una estimaci√≥n r√°pida en 2 minutos</p>
            </div>
          </div>

          <div class="budget-form-wrapper">
            <form class="budget-form">
              <div class="form-group">
                <input type="text" placeholder="Nombre completo" required />
              </div>

              <div class="form-row">
                <div class="form-group">
                  <input type="email" placeholder="Email" required />
                </div>
                <div class="form-group">
                  <input type="tel" placeholder="Tel√©fono" />
                </div>
              </div>

              <div class="form-group">
                <select required>
                  <option value="" disabled selected
                    >Selecciona un modelo</option
                  >
                  <option value="modular">Serie Modular</option>
                  <option value="familiar">Residencia Familiar</option>
                  <option value="alpina">Caba√±a Alpina</option>
                  <option value="studio">Garden Studio</option>
                </select>
              </div>

              <div class="form-group">
                <textarea placeholder="Cu√©ntanos sobre tu proyecto..." rows="4"
                ></textarea>
              </div>

              <button type="submit" class="btn-submit"
                >Enviar solicitud ‚Üí</button
              >
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- TESTIMONIOS -->
    <section class="testimonials-section">
      <div class="container">
        <header class="testimonials-header">
          <span class="eyebrow">Opiniones</span>
          <h2>Lo que dicen de nosotros</h2>
        </header>

        <div class="testimonials-grid">
          <!-- Card 1 -->
          <article class="testimonial-card">
            <div class="testimonial-rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ <span
                style="font-size: 0.8em; color: #999; margin-left: 5px;"
                >9/10</span
              >
            </div>
            <p class="testimonial-text">
              "La experiencia con Tayga ha sido incre√≠ble. Desde el dise√±o
              inicial hasta la entrega de llaves, todo fue fluido. La madera
              huele de maravilla y el aislamiento es perfecto."
            </p>
            <div class="testimonial-author">
              <div class="avatar">MJ</div>
              <div class="info">
                <strong>Mar√≠a Jos√© L.</strong>
                <span>Modelo Alpina</span>
              </div>
            </div>
          </article>

          <!-- Card 2 -->
          <article class="testimonial-card">
            <div class="testimonial-rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span
                style="font-size: 0.8em; color: #999; margin-left: 5px;"
                >10/10</span
              >
            </div>
            <p class="testimonial-text">
              "Busc√°bamos un refugio sostenible y encontramos el hogar de
              nuestros sue√±os. La calidad de los acabados supera lo que
              imagin√°bamos por este precio."
            </p>
            <div class="testimonial-author">
              <div class="avatar">CR</div>
              <div class="info">
                <strong>Carlos Ruiz</strong>
                <span>Residencia Familiar</span>
              </div>
            </div>
          </article>

          <!-- Card 3 -->
          <article class="testimonial-card">
            <div class="testimonial-rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span
                style="font-size: 0.8em; color: #999; margin-left: 5px;"
                >10/10</span
              >
            </div>
            <p class="testimonial-text">
              "El equipo de montaje fue s√∫per profesional y r√°pido. En cuesti√≥n
              de semanas ten√≠amos nuestra casa lista. Muy recomendables."
            </p>
            <div class="testimonial-author">
              <div class="avatar">AG</div>
              <div class="info">
                <strong>Ana Garc√≠a</strong>
                <span>Garden Studio</span>
              </div>
            </div>
          </article>

          <!-- Card 4 -->
          <article class="testimonial-card">
            <div class="testimonial-rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ <span
                style="font-size: 0.8em; color: #999; margin-left: 5px;"
                >8/10</span
              >
            </div>
            <p class="testimonial-text">
              "Muy contentos con el resultado final. Hubo un peque√±o retraso por
              lluvias, pero la comunicaci√≥n fue excelente en todo momento."
            </p>
            <div class="testimonial-author">
              <div class="avatar">PR</div>
              <div class="info">
                <strong>Pedro Rodr√≠guez</strong>
                <span>Serie Modular</span>
              </div>
            </div>
          </article>

          <!-- Card 5 -->
          <article class="testimonial-card">
            <div class="testimonial-rating">
              ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ <span
                style="font-size: 0.8em; color: #999; margin-left: 5px;"
                >10/10</span
              >
            </div>
            <p class="testimonial-text">
              "Simplemente espectacular. La eficiencia energ√©tica se nota desde
              el primer d√≠a. Gracias a todo el equipo de Tayga."
            </p>
            <div class="testimonial-author">
              <div class="avatar">LM</div>
              <div class="info">
                <strong>Luc√≠a M.</strong>
                <span>Modelo Alpina</span>
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>
  </main>
</Layout>

<script src="../scripts/testimonials.js"></script>
